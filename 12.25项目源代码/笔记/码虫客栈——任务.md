# ç è™«å®¢æ ˆâ€”â€”ä»»åŠ¡

1. ### ç¡®å®šOnline JudgeåŸºæœ¬æ¶æ„

2. ###  æ·±å…¥äº†è§£åˆ¤é¢˜ç³»ç»Ÿçš„åŸç†

3. ### æ¸…æ™°RabbitMQåœ¨æ­¤é¡¹ç›®ä¸­çš„ä½œç”¨

4. ### ç¼–å†™å®šæ—¶çˆ¬è™«ä»»åŠ¡ï¼ˆçˆ¬å–é¢˜ç›®ã€æµ‹è¯•ç”¨ä¾‹ï¼‰è‡³æœåŠ¡å™¨



## æ—¥å­¦ä¹ è¿›åº¦

### 12.1

1. å¤§è‡´é˜…è¯»äº† judge.cpp å®ç°åŸç†ï¼Œäº†è§£å®ƒæ˜¯å¦‚ä½•è¿›è¡Œåˆ¤é¢˜çš„ï¼Œforkå¯åŠ¨å­è¿›ç¨‹ã€execvpè°ƒç”¨ç¼–è¯‘ã€setrlimit é™åˆ¶èµ„æºä½¿ç”¨ã€å®šæ—¶å™¨ alarm å®šæ—¶ã€< > é‡å®šå‘è¾“å…¥è¾“å‡º

2. RabbitMQ å­¦ä¹ è‡³ Topic æ¨¡å¼ï¼Œåˆæ­¥äº†è§£ä¸‰ç§æ¨¡å¼çš„å·¥ä½œå½¢æ€ã€‚

3. å¤§è‡´æ¢³ç†äº†æ•´ä½“ Online Judge çš„æ¶æ„ã€‚

   > - ç”¨æˆ·å‘é€è¯·æ±‚è‡³æœåŠ¡å™¨( NodeJS )ï¼ŒæœåŠ¡å™¨è¿›è¡Œæ•´åˆè¯·æ±‚å¹¶ç”Ÿæˆ**UUID**å†™å…¥æ•°æ®åº“æ ‡è®°Waitingï¼ŒåŒæ—¶ç”Ÿäº§è€…å‘é€å¯¹è±¡ï¼ˆCodeã€Lang...ï¼‰è‡³ RabbitMQï¼Œéšåæ•°æ®åº“æ ‡è®°ä¸º Pending ã€‚
   > - åœ¨Dockerå®¹å™¨ä¸­çš„Javaæ¶ˆè´¹è€…ç¨‹åºæ”¶åˆ°RabbitMQæ¨é€çš„æ¶ˆæ¯åï¼Œæ•°æ®åº“æ ‡è®°Processingï¼ŒéšåæŠŠå¯¹è±¡ï¼ˆCodeã€Lang...ï¼‰ä½œä¸ºå‚æ•°é™„åŠ ç»™Judgeç¨‹åºè¿›è¡Œåˆ¤é¢˜ã€‚
   > - Judgeç¨‹åºè¢«å¯åŠ¨åæ•°æ®åº“æ ‡è®°Analyzingï¼ŒCè¯­è¨€ç¼–å†™çš„Judgeç¨‹åºå…ˆè¡ŒæŠŠCodeå†™ä¸ºæ–‡ä»¶å½¢å¼ï¼Œéšåæ ¹æ®Langç±»å‹ä½¿ç”¨forkã€execvpè¿›è¡Œç¼–è¯‘ï¼Œç¼–è¯‘å®Œæ¯•åå†æ¬¡ä½¿ç”¨ä¸‰å‰‘å®¢è¿›è¡Œå¯åŠ¨å­ç¨‹åºï¼Œè¿™ä¸€æ­¥é™å®šå­ç¨‹åºï¼ˆç”¨æˆ·ä»£ç ï¼‰çš„èµ„æºä½¿ç”¨setrlimt([**RLIMIT_CPU**:CPUè¿è¡Œæ—¶é—´,**RLIMIT_AS**:è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜æœ€å¤§å¤§å°...])ï¼Œä½¿ç”¨alarm å®šæ—¶å™¨è¿›è¡Œé™å®šè¿è¡Œæ—¶é—´ï¼Œå‚æ•°ä¸­ command > file è¾“å‡ºé‡å®šå‘è‡³fileæ–‡ä»¶ã€command < file è¾“å…¥é‡å®šå‘è‡³fileæ–‡ä»¶ï¼Œè¿™æ ·ä¸€æ¥åªéœ€è¦æŠŠæ­£ç¡®çš„ç­”æ¡ˆå¯¹æ¯”è¾“å‡ºçš„fileæ–‡ä»¶å³å¯ã€‚
   > - Judgeæœ€åæŠŠç»“æœå†™å…¥è‡³æ•°æ®åº“å³å®Œæˆåˆ¤é¢˜çš„å…¨éƒ¨æµç¨‹ã€‚

### 12.2

1. é‡æ–°æ¢³ç†äº†**<u>CPUè¿è¡Œæ—¶é—´</u>ä¸<u>å®é™…è¿è¡Œæ—¶é—´</u>**çš„æ¦‚å¿µï¼ˆæ˜¨å¤©çš„ç–‘æƒ‘ğŸ¤”ï¼‰ï¼š

> CPUæ—¶é—´ï¼šæŒ‡çš„æ˜¯ä¸€æ®µç¨‹åºåœ¨CPUä¸Šé¢è¿è¡Œæ¶ˆè€—çš„æ—¶é—´ï¼Œä¹Ÿæ˜¯å†…æ ¸æ—¶é—´ï¼ˆkernel time)ã€‚
>
> ç³»ç»Ÿæ—¶é—´(wall clock time, elapsed time)ï¼šæ˜¯æŒ‡ä¸€æ®µç¨‹åºä»è¿è¡Œåˆ°ç»ˆæ­¢ï¼Œç³»ç»Ÿæ—¶é’Ÿèµ°è¿‡çš„æ—¶é—´ã€‚
>
> CPUæ—¶é—´æŒ‡æ ‡æ˜¯CPUä¸ŠèŠ±è´¹çš„æ—¶é—´ï¼Œ**ä¸åŒ…æ‹¬ç­‰å¾…I/Oæˆ–è¿è¡Œå…¶ä»–ç¨‹åº**çš„æ—¶é—´ã€‚

â€‹	rlimitå‡½æ•°ä»…ä»…åªèƒ½è¿›è¡ŒCPUæ—¶é—´çš„æ§åˆ¶ï¼Œä¸èƒ½æ§åˆ¶å®é™…è¿è¡Œçš„æ—¶é—´ï¼Œæ‰€ä»¥åƒæ˜¯ sleep æˆ–è€… IO é˜»å¡ä¹‹ç±»çš„æƒ…å†µæ˜¯æ²¡æœ‰åŠæ³•çš„ï¼Œæ‰€ä»¥è¿˜åœ¨é¢å¤–æ·»åŠ äº†ä¸€ä¸ª alarm æ¥è¿›è¡Œå®é™…æ—¶é—´çš„é™åˆ¶ã€‚

2. ä½¿ç”¨ptraceå‡½æ•°çš„åŸå› ğŸ˜„ï¼š

   > å› ä¸ºç”¨æˆ·æäº¤è¿‡æ¥çš„ä»£ç ä¸­å¯èƒ½å­˜åœ¨æ¶æ„ä»£ç ï¼Œå³ä½¿ä½¿ç”¨äº†rlimitå»é™åˆ¶èµ„æºçš„ä½¿ç”¨ï¼Œé‚£ä¹Ÿæ— æ³•é¿å…forkä¹‹ç±»çš„å¯èƒ½å­˜åœ¨çš„æ¶æ„æ“ä½œçš„ä»£ç ï¼Œæ‰€ä»¥å¤–åŠ ä¸€å±‚ç¨³å¦¥çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨ptraceå‡½æ•°ï¼Œptraceå‡½æ•°é™„åŠ åœ¨å­è¿›ç¨‹ä¸Šé¢ï¼Œè¿›è¡Œæ‰€æœ‰ç³»ç»Ÿè°ƒç”¨çš„ç»Ÿè®¡è¿‡æ»¤ç­‰ç­‰...ï¼Œä¸€æœ‰è¶…å‡ºå¼‚å¸¸çš„æƒ…å†µå°±å‘å‡ºä¿¡å·è®©çˆ¶è¿›ç¨‹æ•è·ï¼Œè®©çˆ¶è¿›ç¨‹ç»ˆæ­¢å­è¿›ç¨‹çš„è¿è¡Œï¼Œå¹¶æŠŠæƒ…å†µå‘Šè¯‰ç»™æ•°æ®åº“ã€‚

ä¸¤ä¸ªç–‘æƒ‘ç‚¹æ¢³ç†ï¼š

> `rlimit` ï¼šæ˜¯åŸºäºè¿›ç¨‹çš„ã€‚`rlimit` å¯ç¡®ç«‹å¯¹æŸä¸ªè¿›ç¨‹å ç”¨å„ç§ç³»ç»Ÿèµ„æºçš„é™åˆ¶ã€‚ç”±è¯¥è¿›ç¨‹åˆ›å»ºçš„æ¯ä¸ªè¿›ç¨‹å‡ä»å…¶åŸå§‹è¿›ç¨‹ç»§æ‰¿æ­¤èµ„æºé™åˆ¶ã€‚èµ„æºé™åˆ¶ç”±ä¸€å¯¹å€¼æ¥å®šä¹‰ã€‚è¿™äº›å€¼æŒ‡å®šäº†å½“å‰ï¼ˆè½¯ï¼‰é™åˆ¶å’Œæœ€å¤§ï¼ˆç¡¬ï¼‰é™åˆ¶ã€‚

> `ptrace`ï¼šè¿›ç¨‹è·Ÿè¸ªï¼ˆprocess traceï¼‰ç³»ç»Ÿè°ƒç”¨é€šå¸¸éƒ½ä¸è°ƒè¯•æœ‰å…³ã€‚å®ƒæ˜¯ç±» Unix ç³»ç»Ÿä¸Šé€šè¿‡åŸç”Ÿè°ƒè¯•å™¨ç›‘æµ‹è¢«è°ƒè¯•è¿›ç¨‹çš„ä¸»è¦æœºåˆ¶ã€‚å®ƒä¹Ÿæ˜¯å®ç° `strace`ï¼ˆç³»ç»Ÿè°ƒç”¨è·Ÿè¸ªsystem call traceï¼‰çš„å¸¸è§æ–¹æ³•ã€‚ä½¿ç”¨ Ptraceï¼Œè·Ÿè¸ªå™¨å¯ä»¥æš‚åœè¢«è·Ÿè¸ªè¿›ç¨‹ï¼Œ**æ£€æŸ¥å’Œè®¾ç½®å¯„å­˜å™¨å’Œå†…å­˜**ï¼Œç›‘è§†ç³»ç»Ÿè°ƒç”¨ï¼Œç”šè‡³å¯ä»¥æ‹¦æˆªï¼ˆinterceptingï¼‰ç³»ç»Ÿè°ƒç”¨ã€‚

3. è¿›ä¸€æ­¥è®¤è¯†RabbitMQå‡ ç§æ¨¡å¼ï¼Œäº†è§£Workæ¨¡å¼ä¸­è½®è¯¢ä¸å…¬å¹³åˆ†å‘æœºåˆ¶ï¼š

> è¡¥å……æ˜¨å¤©ä¸€ç‚¹ï¼š
>
> â€‹	åˆ¤é¢˜æœåŠ¡å™¨ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ç›‘å¬ï¼‰æ”¾åœ¨Dockerå®¹å™¨ä¸Šè¿è¡Œç€ï¼Œä¸€ä¸ªåˆ¤é¢˜æœåŠ¡å™¨è´Ÿè´£ä¸€ä¸ª **åˆ¤é¢˜æœº** ä»»åŠ¡çš„é¢å‘ï¼Œåœ¨RabbitMQ Workæ¨¡å¼ä¸­ï¼Œä½¿ç”¨å…¬å¹³åˆ†å‘ç­–ç•¥æ¥å‡è¡¡çš„æ¨é€ä»»åŠ¡ç»™å‡ ä¸ª**åˆ¤é¢˜æœåŠ¡å™¨**ï¼Œè‹¥å…¶ä¸­ä¸€ä¸ª**åˆ¤é¢˜æœåŠ¡å™¨**å´©æºƒäº†åˆ™å›æŠ¥ç»™**æ¶ˆæ¯é˜Ÿåˆ—**...ï¼ŒçŸ¥è¯†æ²¡è·Ÿä¸Šï¼Œæ˜å¤©è¡¥å……ğŸ˜­ã€‚

4. è®¤è¯†SpringBootä¸­å¦‚ä½•ç¼–å†™ç”Ÿäº§è€…ä»¥åŠæ¶ˆè´¹è€…çš„ç›¸å…³ä»£ç ã€‚

### 12.3

1. ç¿»è¶Šäº†å¤§é‡æ–‡ç« å»è®¤è¯†ä¸äº†è§£`ptrace`å‡½æ•°çš„ä½¿ç”¨ï¼Œä½†æ˜¯åœ¨ä¸€èˆ¬çš„Intelä¸AMDä¸­å¯ä»¥ä½¿ç”¨`ORIG_EAX`å¸¸é‡ï¼Œè¿™ä¸ªä»£è¡¨çš„æ˜¯ç³»ç»Ÿè°ƒç”¨å·ã€‚

   > â€‹	Linuxæ‰€æœ‰çš„ç³»ç»Ÿè°ƒç”¨éƒ½æ˜¯é€šè¿‡è½¯ä¸­æ–­ int 0x80æ¥å®ç°çš„ï¼Œè€Œç³»ç»Ÿè°ƒç”¨å·æ˜¯å­˜åœ¨å¯„å­˜å™¨EAXä¸­çš„. æ‰€ä»¥å¦‚æœæƒ³è·å–ç³»ç»Ÿè°ƒç”¨å·ï¼Œåªéœ€è¦è·å–ORIG_EAXçš„å€¼å°±å¯ä»¥äº†ã€‚

   ä½†æ˜¯åœ¨M1 ARMæ¶æ„ä¸­å¹¶æ²¡æœ‰è¿™ä¸ªå¸¸é‡çš„å€¼ã€‚æ‰€æœ‰çš„ç³»ç»Ÿè°ƒç”¨éƒ½æ˜¯é€šè¿‡SWIæ¥å®ç°çš„ï¼Œè™½ç„¶ä¹Ÿæ˜¯è½¯ä¸­æ–­ï¼Œä½†æ–¹å¼ä¸åŒï¼Œå› ä¸ºåœ¨ARM æ¶æ„ä¸­æœ‰ä¸¤ä¸ªSWIæŒ‡ä»¤ï¼Œåˆ†åˆ«é’ˆå¯¹EABIå’ŒOABI ã€‚åç»­ä¸æ¸…æ¥šå¦‚ä½•è·å–åˆ°ARMæ¶æ„ä¸­çš„ç³»ç»Ÿè°ƒç”¨å·ï¼Œæ‰€ä»¥æš‚æ—¶ä¸å¾—ä¸æ”¾å¼ƒä½¿ç”¨`ptrace`å‡½æ•°ã€‚

2. RabbitMQ é«˜çº§éƒ¨åˆ† - TTL -> è®¾ç½®é˜Ÿåˆ—çš„è¿‡æœŸæ—¶é—´ï¼Œåº”ç”¨åœºæ™¯ï¼šæ”¯ä»˜è¶…è¿‡æ—¶é—´åˆ™é»˜è®¤å–æ¶ˆï¼›TTLæ¶ˆæ¯è¿‡æœŸæ—¶é—´ -> å•æ¡è®¾ç½®è¿‡æœŸæ—¶é—´é€šè¿‡åœ¨ç”Ÿäº§è€…ä¸­`MessagePostProcessor`

   ```java
   MessagePostProcessor messagePostProcessor = new MessagePostProcessor() {
     @Override
     public Message postProcessMessage(Message message) throws AmqpException {
       // è®¾ç½®å•æ¡ä¿¡æ¯è¿‡æœŸæ—¶é—´
       message.getMessageProperties().setExpiration(5000); // 5ç§’
       return message;
     }
   };
   // å‘é€
   rabbitTemplate.convertAndSend(exchangeName, routingKey, messageContent, messagePostProcessor);
   ```

### 12.4

![img](./img/rabbitmq.png)

1. RabbitMQ ä¸­çš„æ­»ä¿¡é˜Ÿåˆ—ï¼Œæ•…åæ€ä¹‰å®ƒæ˜¯ç”¨æ¥ç®¡ç†å·²ç»è¢«æŠ›å¼ƒçš„ä¿¡æ¯çš„é˜Ÿåˆ—ï¼Œä¿—ç§°`å¤‡èƒé˜Ÿåˆ—`ï¼Œå®ƒæ˜¯æ”¶é›†ä¸€ä¸ªè®¾ç½®äº†TTLè¿‡æœŸæ—¶é—´é˜Ÿåˆ—ä¸­ï¼Œè¿‡æœŸåçš„æ¶ˆæ¯æ¥åˆ°äº†æ­»ä¿¡é˜Ÿåˆ—ï¼ˆæœ‰ç‚¹åƒ`åƒåœ¾æ¡¶`ï¼‰ã€‚

   â€‹	åœ¨å£°æ˜ä¸­é…ç½®å¥½äº¤æ¢æœºä¸é˜Ÿåˆ—çš„ç»‘å®šå…³ç³»ï¼š

```java
@Configuration
public class TTLRabbitMqConfiguration {
    @Bean
    public DirectExchange ttlDirectExchange(){
      	// äº¤æ¢æœºåç§°ï¼šttl_direct_exchange
        return new DirectExchange("ttl_direct_exchange",true,false);
    }
    @Bean
    public Queue directTTLQueue(){
        Map<String ,Object>args = new HashMap<>();
        // è¶…æ—¶æ—¶é—´è®¾ç½®
        args.put("x-message-ttl",5000);
        // æ­»ä¿¡é˜Ÿåˆ—ç»‘å®šï¼Œdirect æ¨¡å¼ä¸‹éœ€è¦é™„åŠ  RoutingKey
        args.put("x-dead-letter-exchange", "dead_direct_exchange"); // ç»‘å®šæ­»ä¿¡é˜Ÿåˆ—
        args.put("x-dead-letter-routing-key", "dead"); // æ­»ä¿¡é˜Ÿåˆ—å¯¹åº”çš„ RoutingKey
      	// é˜Ÿåˆ—åç§°ï¼šttl.direct.queue
        return new Queue("ttl.direct.queue",true,false,false,args);
    }
    @Bean
    public Binding directTTLBinding(){
        return BindingBuilder.bind(directTTLQueue()).to(ttlDirectExchange()).with("ttl");
    }
}
```

â€‹	å£°æ˜æ­»ä¿¡é˜Ÿåˆ—ï¼š	

```java
@Configuration
public class DeadRabbitMqConfiguration {
    @Bean
    public DirectExchange deadDirectExchange() {
        return new DirectExchange("dead_direct_exchange", true, false);
    }
    // æ­»ä¿¡é˜Ÿåˆ—
    @Bean
    public Queue deadDirectQueue() {
        return new Queue("dead.direct.queue");
    }
    @Bean
    public Binding deadDirectBinding() {
        return BindingBuilder.bind(deadDirectQueue()).to(deadDirectExchange()).with("dead");
    }
}
```

ç”Ÿäº§è€…å¾€è¢«ç»‘å®šå¥½æ­»ä¿¡é˜Ÿåˆ—çš„äº¤æ¢æœºç”Ÿäº§æ¶ˆæ¯ï¼š

```java
// é«˜çº§ TTLæ¶ˆæ¯è¿‡æœŸæ—¶é—´
public void makeOrderDirectTTL() {
  String orderId = UUID.randomUUID().toString(); // éšæœºUUID
  System.out.println("è®¢å•é˜Ÿåˆ—æ´¾å‘æˆåŠŸOrderId->" + orderId);
  String exchangeName = "ttl_direct_exchange";
  String routingKey = "ttl";
  rabbitTemplate.convertAndSend(exchangeName, routingKey, orderId);
}
```

è¡¥å……è¯´æ˜ï¼š

â€‹	æ¶ˆæ¯å˜æˆæ­»ä¿¡ï¼Œæœ‰ä¸‹é¢å‡ ä¸ªå¯èƒ½ï¼š

> - æ¶ˆæ¯è¢«æ‹’ç»
> - æ¶ˆæ¯è¿‡æœŸ
> - é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦



### 	12.4

1. æ¥è§¦åˆ°ä¸€ä¸ªéå¸¸å±é™©çš„ä»£ç ï¼š`main[-1u]={1};`

> æ— ç¬¦å·ç®—æœ¯çš„æ¨¡æ•°æ¯”ç»™å®šç±»å‹çš„æœ€å¤§å€¼å¤šä¸€ä¸ªã€‚
>
> å› æ­¤`-1U`ä¸º`-1 + MAX_UINT + 1`ï¼Œåœ¨`2^32-1`çš„æ¶æ„ä¸Šä¸º`unsigned == uint32_t`ã€‚å¦‚æœä½ çš„`sizeof(int) == 4`ï¼Œ `int x[-1U] = {1};`å°†éœ€è¦`4*(2^32-1) B =~ 16 GiB`å­˜å‚¨ï¼Œå¹¶ä¸”å­˜å‚¨ä¸ä¼šè¢«åˆ é™¤ï¼Œå› ä¸ºå®ƒä¸æ˜¯å…¨é›¶ã€‚

2. å°è¯•ä½¿ç”¨python ä¸­ resourceåº“çš„setrlimité™åˆ¶å­è¿›ç¨‹çš„èµ„æºä½¿ç”¨ï¼Œä½†æ˜¯åœ¨M1çš„OSXä¸­ä½¿ç”¨è¯¥æ–¹æ³•ä¼šå‡ºç°ä¸€äº›pythonçš„é”™è¯¯ï¼Œpythonå®˜æ–¹ç»™å‡ºçš„å›å¤ï¼š

   > â€‹	ç°åœ¨åœ¨è¾ƒæ–°ç‰ˆæœ¬çš„ macOSï¼ˆæ˜¾ç„¶æ˜¯ 10.14.4 ç‰ˆï¼‰ä¸­è¿è¡Œæ—¶å­˜åœ¨ä¸€äº›æƒ…å†µï¼Œå³å°è¯•åœ¨è¿è¡Œæ—¶ä½¿ç”¨ resource.RLIMIT_STACK å¢åŠ å †æ ˆé™åˆ¶å¤±è´¥ã€‚å¦‚æœæ‚¨ç¡®å®éœ€è¦å¢åŠ å †æ ˆé™åˆ¶ï¼Œä»¥å¤„ç†æ›´æ·±å±‚æ¬¡çš„é€’å½’ç­‰ï¼Œä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨æ›´å¤§çš„å †æ ˆå¤§å°ä¸º macOS é‡å»º Pythonï¼Œå¦‚PR 14546æ‰€ç¤ºï¼Œè€Œä¸æ˜¯å°è¯•åœ¨è¿è¡Œæ—¶æ›´æ”¹å®ƒã€‚

   ç»§ç»­ç†Ÿæ‚‰`setrlimit`ï¼ˆæµ‹è¯•ç”µè„‘è®¡ç®—æ¬¡æ•°ç¨‹åºï¼‰ï¼š

   ```c
   //
   //  main.c
   //  Fork
   //
   //  Created by é»„æ³½æ—­ on 2021/12/1.
   //
   #include <sys/resource.h>
   #include <stdio.h>
   #include <unistd.h>
   #include <stdlib.h>
   #include <signal.h>
   void sighandler(int);
   int i = 0;  
   int main(int argc, const char * argv[]) {
     signal(SIGXCPU, sighandler);
   
     struct rlimit new_lim;
   
     new_lim.rlim_cur = 1;
     new_lim.rlim_max = 5;
   
     setrlimit(RLIMIT_CPU, &new_lim);
   
     int count = 0;
   
     for (;i<1000000000; i++) {
         count += i;
     }
     printf("result %d\n",count);
     return 0;
   
   }
   void sighandler(int signum)
   {
     printf("æ‚¨çš„ç”µè„‘ä¸€ç§’é’Ÿå¯è®¡ç®—%dæ¬¡\n",i);
     exit(1);
   }
   ```

   4. åœ¨OS Xç³»ç»Ÿä¸­ä½¿ç”¨`setrlimit`è®¾ç½®è™šæ‹Ÿå†…å­˜å¤§å°`RLIMIT_AS`ä¼šå¤±è´¥ã€‚

   5. å¤§è‡´æŠŠåˆ¤é¢˜æœºçš„ä¼ªä»£ç å†™å®Œï¼š

      ```c
      //
      //  main.c
      //  Fork
      //
      //  Created by é»„æ³½æ—­ on 2021/12/1.
      //
      #include <sys/resource.h>
      #include <stdio.h>
      #include <unistd.h>
      #include <stdlib.h>
      #include <signal.h>
      
      #include <sys/types.h>
      #include <sys/wait.h>
      #define FILE_SIZE 10
      #define MB 1048576
      
      
      void sighandler(int);
      void setrlimit__();
      int compile();
      void run();
      void judge();
      int main(int argc, const char * argv[]) {
      
        int status = compile();
        printf("This Status is: %d\n",status);
      
        judge();
        return 0;
      }
      
      // ä»£ç ç¼–è¯‘
      int compile(){
        int time_limit = 6;
      
        const char *COMP_C[] = {"gcc","-Wall","-lm","Main.c","-o","Main",NULL};
      
        pid_t pid = fork();
        if(pid == -1){
          printf("Error:\n");
          return -1;
        }else if(pid != 0){ // parent
          int status;
          waitpid(pid, &status, 0);
          return status;
        }else{ // child
          // è®¾ç½®ç¼–è¯‘æ—¶çš„èµ„æºé™åˆ¶
          struct rlimit lim;
          lim.rlim_cur = lim.rlim_max = time_limit;
          // è®¾ç½®CPUè¿è¡Œæ—¶é—´
          setrlimit(RLIMIT_CPU, &lim);
          // è®¾ç½®å®é™…è¿è¡Œæ—¶é—´ -> å®šæ—¶å™¨
          alarm(0);
          alarm(time_limit);
      
          // ... 
      
          // é‡å®šå‘æ­¤å­è¿›ç¨‹çš„é”™è¯¯è¾“å‡ºåˆ°æ–‡ä»¶
          freopen("error.dat","w",stderr);
          execvp(COMP_C[0],(char* const*)COMP_C);
          exit(0);
        }
        return 0;
      }
      
      // åˆ¤é¢˜
      void judge(){
        // ... è·å–æœ€å¤§æ—¶é—´ä»¥åŠç©ºé—´
      
      
        // è¿è¡Œç¨‹åº
        pid_t pidRun = fork();
        if(pidRun == 0){ // child
          run();
          exit(0);
        }else{
          // ç›‘è§†æ—¶é—´ç©ºé—´...
        }
        
      }
      
      // è¿è¡Œç¨‹åº
      void run(){
        int time_limit = 2000; // å‡è®¾é¢˜ç›®è¦æ±‚2ç§’
      
        // é¢˜ç›®çš„é™å®šèµ„æº
        struct rlimit lim;
      
        // é™å®šCPUæ—¶é—´ä»¥åŠå®é™…è¿è¡Œæ—¶é—´
        lim.rlim_cur = lim.rlim_max = time_limit / 1000.0 + 1;
        setrlimit(RLIMIT_CPU, &lim);
        alarm(0);
        alarm(time_limit / 1000.0+1);
      
        // é™å®šè¿›ç¨‹å¯ä»¥åˆ›å»ºçš„æœ€å¤§æ–‡ä»¶å¤§å°
        lim.rlim_max = (FILE_SIZE<<20) + MB;
        lim.rlim_cur = FILE_SIZE<<20;
        setrlimit(RLIMIT_FSIZE, &lim);
      
        // é™å®šè¿›ç¨‹å †æ ˆçš„æœ€å¤§å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ã€‚
        lim.rlim_cur = lim.rlim_max = MB << 6;
        setrlimit(RLIMIT_STACK, &lim);
      
        execl("./Main","./Main",NULL);
      }
      ```

      

   ### 12.5

   

   1. é‡æ–°æ¸©ä¹ äº†DockerFileï¼Œäº†è§£äº†CMDä¸ENTRYPOINTçš„åŒºåˆ«ï¼š

   > `ENTRYPOINT` æŒ‡å®šçš„å‘½ä»¤éœ€è¦ä¸`docker run` å¯åŠ¨å®¹å™¨è¿›è¡Œæ­é…ï¼Œå°†docker run æŒ‡ä»¤åé¢è·Ÿçš„å†…å®¹å½“åš**å‚æ•°**ä½œä¸ºENTRYPOINTæŒ‡ä»¤æŒ‡å®šçš„è¿è¡Œå‘½ä»¤çš„å‚æ•°ï¼ŒENTRYPOINT æŒ‡å®šçš„linuxå‘½ä»¤ä¸€èˆ¬æ˜¯ä¸ä¼šè¢«è¦†ç›–çš„ã€‚

		2.	Judge æµç¨‹ï¼š

![å·¥ä½œæµç¨‹å›¾](./img/æµç¨‹å›¾.png)



![åˆ¤é¢˜æœºæµç¨‹](./img/åˆ¤é¢˜æœºæµç¨‹.png)

3. äº†è§£ä¸€ä¸ªæ¦‚å¿µï¼š`Special Judge`

> å¯¹äºåŒä¸€é“é¢˜ç›®ï¼Œç”¨æˆ·å¯èƒ½ä½¿ç”¨å„ç§ä¸åŒçš„æ–¹æ³•æ¥è§£ç­”ï¼Œæ‰€ä»¥å¯¹äºæŸäº›ç‰¹æ®Šçš„é¢˜ç›®ï¼Œå…¶ç»“æœå¯èƒ½ä¸å”¯ä¸€ï¼Œä½†éƒ½ç¬¦åˆé¢˜ç›®è¦æ±‚ã€‚æ­¤ç±»é¢˜ç›®å°±éœ€è¦è¿›è¡Œç‰¹åˆ¤(Special Judge)ã€‚
>
> ä¾‹å¦‚ï¼š**ç»™å‡ºä¸€ä¸ªä¸å°äº 12 çš„æ­£æ•´æ•°nï¼Œè¯·ä½ è¾“å‡ºä¸¤ä¸ªåˆæ•°ï¼Œä½¿ä»–ä»¬çš„å’Œç­‰äºnã€‚**
>
> åˆ†æé¢˜æ„ï¼Œå¯ä»¥å¾—å‡ºç³»ç»Ÿåˆ¤æ–­ç”¨æˆ·è¾“å‡ºæ˜¯å¦æ­£ç¡®çš„ä¸¤ä¸ªæ¡ä»¶æ˜¯ï¼šè¾“å‡ºçš„ä¸¤ä¸ªæ•°æ˜¯å¦å‡ä¸ºåˆæ•°ï¼›è¾“å‡ºçš„ä¸¤ä¸ªæ•°ä¹‹å’Œæ˜¯å¦ä¸ºnã€‚
>
> é¦–å…ˆåˆ†åˆ«åˆ¶å®šdata.inï¼ˆæµ‹è¯•è¾“å…¥ï¼‰ã€data.outï¼ˆæµ‹è¯•è¾“å‡ºï¼‰å¦‚ä¸‹ï¼š
>
> `filename: data.in`
>
> ```shell
> 1
> 2
> 3
> 4
> 3
> 12
> 15
> 1000
> ```
>
> `filename: data.out`
>
> ```shell
> 1
> 2
> 3
> 8 4
> 9 6
> 500 500
> ```
>
> è§£å†³æ–¹æ¡ˆï¼š
>
> ä¸€èˆ¬çš„é¢˜ç›®åˆ¤é¢˜æœºè¿è¡Œå®Œåé‡å®šå‘è¾“å…¥ï¼Œéšåå¯¹æ¯”ä¸€ä¸‹æ ‡å‡†è¾“å‡ºä¸ç”¨æˆ·è¾“å‡ºæ˜¯å¦ä¸€è‡´å³å¯åˆ¤å®šã€‚
>
> å…ˆæŠŠ`data.in`æ•°æ®æ‰”ç»™ç”¨æˆ·å†™çš„ç¨‹åºè¿›è¡Œè¿è¡Œéšåé‡å®šå‘ç”¨æˆ·è¾“å‡ºæ•°æ®ä¸ºuser.outï¼Œéšåæ‰§è¡Œç®¡ç†å‘˜å†™å¥½çš„`spj.cc`ï¼ˆç‰¹åˆ¤ç¨‹åºï¼‰è¿›è¡Œç‰¹æ®Šåˆ¤å®šï¼Œç‰¹æ®Šç¨‹åºä¼šè¯»å…¥`data.in`ï¼ˆæµ‹è¯•è¾“å…¥ï¼‰ã€`data.out`ï¼ˆæµ‹è¯•è¾“å‡º-<u>å¯ä»¥ä¸ç”¨</u>ï¼‰ã€`user.out`ï¼ˆç”¨æˆ·è¾“å‡ºï¼‰ï¼Œç¨‹åºå…ˆæŠŠæµ‹è¯•è¾“å…¥è¿›è¡Œ**è¡Œæ‹†åˆ†**ï¼ŒéšååŒæ ·æ–¹å¼è¯»å–ç”¨æˆ·è¡Œæ•°æ®ï¼ŒæŠŠç”¨æˆ·æ•°æ®ä»¥ç‰¹å®šåˆ¤å®šæ–¹å¼å¤„ç†åä¸**æµ‹è¯•è¾“å…¥**è¿›è¡Œæ¯”å¯¹ï¼Œå¯¹æ¯”ç›¸ç­‰å³è§†ä¸ºAC(Accept)ã€‚è¿”å›æˆåŠŸç»“æœåï¼Œåˆ¤é¢˜æœºä¼šæ”¶åˆ°ç»“æœéšåè¿›è¡Œæ±‡æŠ¥ã€‚
>
> å¯¹äºä»¥ä¸Šé¢˜ç›®å¯æœ‰ä¸‹é¢çš„**ç‰¹åˆ¤ç¨‹åº**
>
> ```c
> #include <stdio.h>
> bool is_prime(int x) {
>     for(int i = 2; i <= n / 2; i++) {
>         if(n % i == 0) {                   //ç¬¦åˆè¯¥æ¡ä»¶ä¸æ˜¯ç´ æ•°
>             return true;
>         }
>     }
> }
> int main(int argc, char *args[]) {
>     FILE * f_in   = fopen(args[1], "r");    //æµ‹è¯•è¾“å…¥
>     FILE * f_out  = fopen(args[2], "r");    //æµ‹è¯•è¾“å‡º
>     FILE * f_user = fopen(args[3], "r");    //ç”¨æˆ·è¾“å‡º
>     int ret = 0;                            //è¿”å›å€¼
>     int T, n, a, b;
>     fscanf(f_in, "%d", &T);                 //ä»è¾“å…¥ä¸­è¯»å–æ•°æ®ç»„æ•°T
>     while(T--) {
>         fscanf(f_in  , "%d"  , &n    );
>         fscanf(f_user, "%d%d", &a, &b);
>         if(a + b != n || is_prime(a) || is_prime(b))
>         ret = 1;                            //Wrong Answer
>     }
>     fclose(f_in);
>     fclose(f_out);
>     fclose(f_user);
>     return ret;
> }
> ```
>
> ç¬¬äºŒç§ç‰¹æ®Šé¢˜å‹ï¼š**ç»è¿‡ä¸€å®šå¤æ‚è®¡ç®—åè¾“å‡ºä¸€ä¸ªå®æ•°ç»“æœï¼Œç²¾åº¦è¦æ±‚æ§åˆ¶åœ¨10âˆ’4 å†…ã€‚**
>
> ä»£ç å¦‚ä¸‹ï¼š
>
> ```c
> #include <stdio.h>
> const double eps = 1e-4;
> int main(int argc,char *args[]) {
>     FILE * f_in   = fopen(args[1], "r");    //æµ‹è¯•è¾“å…¥
>     FILE * f_out  = fopen(args[2], "r");    //æµ‹è¯•è¾“å‡º
>     FILE * f_user = fopen(args[3], "r");    //ç”¨æˆ·è¾“å‡º
>     int ret = 0;                            //è¿”å›å€¼
>     int T;
>     double a, x;
>     fscanf(f_in, "%d", &T);                 //ä»è¾“å…¥ä¸­è¯»å–æ•°æ®ç»„æ•°T
>     while(T--) {
>         fscanf(f_out , "%lf", &a);
>         fscanf(f_user, "%lf", &x);
>         if(fabs(a-x) > eps) {
>             ret = 1;                        //Wrong Answer
>         }
>     }
>     fclose(f_in);
>     fclose(f_out);
>     fclose(f_user);
>     return ret;
> }
> ```
>
> 

### 12.6

1. ç¡®å®šåˆ¤é¢˜æœºMainæ¥å—å‚æ•°ï¼š

   > `c`CodePathï¼šä¼ è¿›æ¥çš„ç”¨æˆ·ä»£ç è·¯å¾„ï¼Œå¯ä»¥ç›´æ¥å¯¹éœ€è¦åˆ¤é¢˜çš„ä»£ç è¿›è¡Œç¼–è¯‘ã€è¿è¡Œæ“ä½œã€‚
   >
   > `d`CodeUidï¼šæäº¤ä»»åŠ¡ä»£ç çš„IDä¸²ï¼Œç”¨æ¥ä¿å­˜ç”¨æˆ·è¾“å‡ºæ•°æ®ã€‚
   >
   > `l`Langï¼šè¯­è¨€è¿è¡Œç¯å¢ƒï¼›1: Cè¯­è¨€ã€2: C++è¯­è¨€ã€3: Python...ã€‚
   >
   > `t`TimeLimitï¼šæ—¶é—´é™åˆ¶ï¼ŒæŒ‡å®é™…è¿è¡Œçš„æ—¶é—´ï¼ŒåŒ…æ‹¬I/Oç­‰å¾…æ—¶é—´
   >
   > `r`RunDir: è¿è¡Œä»£ç çš„ç›®å½•ï¼Œç»“æœå­˜æ”¾çš„ä½ç½®
   >
   > `e`ExampleDir: é¢˜ç›®æ ·ä¾‹ç›®å½•ä½ç½®ï¼Œè‡ªåŠ¨è¯»å–ç›®å½•ä¸‹æ‰€æœ‰çš„é¢˜ç›®
   >
   > `s`CustomInput: ç”¨æˆ·è‡ªå®šä¹‰è¾“å…¥çš„æ–‡ä»¶è·¯å¾„
   
   > MemLimitï¼šç©ºé—´é™åˆ¶ï¼Œå•ä½MBã€‚// å„å¤§ç½‘ç«™ä¸å‡†ç¡®ï¼Œæ”¾å¼ƒã€‚
   >
   > ä¾‹å­ï¼š
   >
   > ```shell
   >sudo ./Run /Users/huangzexu/Code/C-C++/test/Main.c 0f44a62825d16b301e9c330bad507788 1 1
   > 
   >sudo ./Run -c /Users/huangzexu/Code/C-C++/test/Main.cpp -d 0f44a62825d16b301e9c330bad507788 -l 1 -t 1 -r /Users/huangzexu/Code/C-C++/test -e /Users/huangzexu/Code/C-C++/test/28485
   > ```

### 12.13

è¿™å‡ å¤©æœ‰ç‚¹å…¶ä»–äº‹æƒ…å¿™æ´»äº†ï¼Œæ²¡æ€ä¹ˆæ›´æ–°è¿›åº¦ã€‚

1. ç¼–å†™åˆ¤é¢˜æœºï¼Œæœ€åå‰©ä½™å¤šæµ‹è¯•æ ·ä¾‹ä¸‹çš„ä»£ç ä»¥åŠæ¥å…¥æµ‹è¯•ã€‚



### 12.14

é¢˜ç›®`20981`ï¼š

```shell
sudo ./Run -c /Users/huangzexu/Code/C-C++/test/Main.cpp -d 0f44a62825d16b301e9c330bad507788 -l 1 -t 1 -r /Users/huangzexu/Code/C-C++/test -e /Users/huangzexu/Code/C-C++/test/20981
```

1. c++ä¸­çš„è¯»å†™äºŒè¿›åˆ¶`ifstream`

   >ofstreamæ˜¯ä»å†…å­˜åˆ°ç¡¬ç›˜ï¼Œifstreamæ˜¯ä»ç¡¬ç›˜åˆ°å†…å­˜ï¼Œå…¶å®æ‰€è°“çš„æµç¼“å†²å°±æ˜¯å†…å­˜ç©ºé—´

```c++
/*
 * è¯»å…¥æ–‡ä»¶æ•°æ®è‡³string
 */
string readFileIntoString(string filename)
{
  ifstream ifile(filename);
  //å°†æ–‡ä»¶è¯»å…¥åˆ°ostringstreamå¯¹è±¡bufä¸­
  ostringstream buf;
  char ch;
  while (buf && ifile.get(ch))
    buf.put(ch);
  //è¿”å›ä¸æµå¯¹è±¡bufå…³è”çš„å­—ç¬¦ä¸²
  return buf.str();
}
```

sudo /Judge/Run -c /Judge/1992.cpp -d 0f44a62825d16b301e9c330bad507788 -l 1 -t 1 -r /Judge -e /Subject/1992

### 12.17

1. å…³äºå¤šå°åˆ¤é¢˜æœåŠ¡å™¨çš„é¢˜åº“æ•°æ®å¦‚ä½•å…³è”ï¼š

   ![types of mounts and where they live on the Docker host](./img/volume.png)

   > é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨å®¹å™¨å†…åˆ›å»ºçš„æ‰€æœ‰æ–‡ä»¶éƒ½å­˜å‚¨åœ¨å¯å†™å®¹å™¨å±‚ä¸Šã€‚è¿™æ„å‘³ç€ï¼š
   >
   > - å½“è¯¥å®¹å™¨ä¸å†å­˜åœ¨æ—¶ï¼Œæ•°æ®ä¸ä¼šä¿ç•™ï¼Œå¦‚æœå¦ä¸€ä¸ªè¿›ç¨‹éœ€è¦æ•°æ®ï¼Œåˆ™å¾ˆéš¾å°†æ•°æ®ä»å®¹å™¨ä¸­å–å‡ºã€‚
   > - å®¹å™¨çš„å¯å†™å±‚ä¸è¿è¡Œå®¹å™¨çš„ä¸»æœºç´§å¯†è€¦åˆã€‚æ‚¨æ— æ³•è½»æ¾åœ°å°†æ•°æ®ç§»åŠ¨åˆ°å…¶ä»–ä½ç½®ã€‚
   > - å†™å…¥å®¹å™¨çš„å¯å†™å±‚éœ€è¦[å­˜å‚¨é©±åŠ¨ç¨‹åº](https://docs.docker.com/storage/storagedriver/)æ¥ç®¡ç†æ–‡ä»¶ç³»ç»Ÿã€‚å­˜å‚¨é©±åŠ¨ç¨‹åºä½¿ç”¨ Linux å†…æ ¸æä¾›è”åˆæ–‡ä»¶ç³»ç»Ÿã€‚ä¸ä½¿ç”¨*æ•°æ®å·*ç›¸æ¯”ï¼Œè¿™ç§é¢å¤–çš„æŠ½è±¡é™ä½äº†æ€§èƒ½ï¼Œæ•°æ®å·ç›´æ¥å†™å…¥ä¸»æœºæ–‡ä»¶ç³»ç»Ÿã€‚
   >
   > Docker ä¸ºå®¹å™¨æä¾›äº†ä¸¤ä¸ªé€‰é¡¹ï¼Œç”¨äºå°†æ–‡ä»¶å­˜å‚¨åœ¨ä¸»æœºä¸­ï¼Œä»¥ä¾¿å³ä½¿åœ¨å®¹å™¨åœæ­¢åä»ä¿ç•™æ–‡ä»¶ï¼š*å·*å’Œ*ç»‘å®šè£…è½½*ã€‚

   â€‹	åœ¨å®¿ä¸»æœºä¸Šé€šè¿‡å‘½ä»¤åˆ›å»ºå¤šä¸ªå®¹å™¨ï¼Œå°†å…¶å‡æŒ‚è½½è‡³å®¿ä¸»æœºçš„é¢˜ç›®æ•°æ®ç›®å½•ï¼Œä¸ºäº†å®‰å…¨ç€æƒ³ï¼Œ"è¯»å†™åˆ†ç¦»"ï¼Œå®¿ä¸»æœºä¸Šé¢è¿è¡Œå¤šä¸€ä¸ªæœåŠ¡è´Ÿè´£ç®¡ç†é¢˜ç›®å¢åˆ æ”¹æŸ¥...ï¼Œå®¹å™¨é‡Œä¸èƒ½ç›´æ¥å¯¹è¯¥ç›®å½•è¿›è¡Œä¿®æ”¹æ“ä½œï¼Œåªå…è®¸è¯»ã€‚

Dockerä¸­çš„åªè¯»å·ï¼š

>â€‹	å¯¹äºæŸäº›å¼€å‘åº”ç”¨ç¨‹åºï¼Œå®¹å™¨éœ€è¦å†™å…¥ç»‘å®šè£…è½½ï¼Œä»¥ä¾¿å°†æ›´æ”¹ä¼ æ’­å› Docker ä¸»æœºã€‚åœ¨å…¶ä»–æ—¶å€™ï¼Œå®¹å™¨åªéœ€è¦å¯¹æ•°æ®çš„è¯»å–è®¿é—®æƒé™ã€‚è¯·è®°ä½ï¼Œå¤šä¸ªå®¹å™¨å¯ä»¥è£…è½½åŒä¸€ä¸ªå·ï¼Œå¹¶ä¸”å¯ä»¥åŒæ—¶ä¸ºå…¶ä¸­ä¸€äº›å®¹å™¨è¿›è¡Œè¯»å†™è£…è½½ï¼Œè€Œå¯¹å…¶ä»–å®¹å™¨è¿›è¡Œåªè¯»è£…è½½ã€‚
>
>æ­¤ç¤ºä¾‹ä¿®æ”¹äº†ä¸Šé¢çš„å†…å®¹ï¼Œä½†å°†ç›®å½•ä½œä¸ºåªè¯»å·æŒ‚è½½ï¼Œæ–¹æ³•æ˜¯å°†`ro`æ·»åŠ åˆ°å®¹å™¨å†…è£…å…¥ç‚¹ä¹‹åçš„é€‰é¡¹åˆ—è¡¨ä¸­ï¼ˆé»˜è®¤æƒ…å†µä¸‹ä¸ºç©ºï¼‰ã€‚å¦‚æœå­˜åœ¨å¤šä¸ªé€‰é¡¹ï¼Œè¯·ç”¨é€—å·åˆ†éš”ã€‚
>
>`--mount`å’Œ`-v`ç¤ºä¾‹å…·æœ‰ç›¸åŒçš„ç»“æœã€‚
>
>`--mount`
>
>```shell
>docker run -d \
>  --name=nginxtest \
>  --mount source=nginx-vol,destination=/usr/share/nginx/html,readonly \
>  nginx:latest
>```
>
>`-v`
>
>```shell
>docker run -d \
>  --name=nginxtest \
>  -v nginx-vol:/usr/share/nginx/html:ro \
>  nginx:latest
>```

2. å…³äºRabbitMQä¸­çš„è®¾è®¡

   sudo ./Run -c /Users/huangzexu/Code/C-C++/test/Main.cpp -d 0f44a62825d16b301e9c330bad507788 -l 1 -t 1 -r /Users/huangzexu/Code/C-C++/test -e /Users/huangzexu/Code/C-C++/test/20981

   >åœ¨NodeJsä¸­çš„RabbitMQï¼Œéœ€è¦ä¸»åŠ¨è·å–æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œæ¶ˆæ¯åŒ…æ‹¬JavaæœåŠ¡å™¨ç”Ÿäº§çš„æ•°æ®å¯¹è±¡ï¼š
   >
   >`UserCode`: ç”¨æˆ·ä»£ç ï¼Œå‰ç«¯æŠŠç”¨æˆ·ä»£ç è¿›è¡ŒBase64ç¼–ç åæäº¤è‡³æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨åŸå°ä¸åŠ¨ç”Ÿæˆåˆ°æ¶ˆæ¯é˜Ÿåˆ—ã€‚
   >
   >`TaskId`: ä»»åŠ¡IDï¼Œå‰ç«¯æäº¤åŸºæœ¬çš„å‡ ä¸ªå‚æ•°ç»™æœåŠ¡å™¨åï¼ŒæœåŠ¡å™¨è´Ÿè´£ç”Ÿæˆçš„ä»»åŠ¡IDã€‚
   >
   >`SubjectId`ï¼šé¢˜ç›®IDï¼Œå‰ç«¯åœ¨æäº¤çš„æ—¶å€™å·²ç»é™„åŠ æ­¤å‚æ•°ã€‚
   >
   >

### 12.18

1. åŸºæœ¬å®Œæˆæ¶ˆè´¹è€…çš„é€»è¾‘>æ”¶åˆ°ä»»åŠ¡åå¯åŠ¨judgeè¿›è¡Œåˆ¤é¢˜

2. å®Œæˆç”Ÿäº§è€…åœ¨æ”¶åˆ°å‰ç«¯æ¶ˆæ¯åå‘MQå‘é€ä»»åŠ¡

3. è®¾è®¡æ•°æ®åº“ï¼š

4. ä½¿ç”¨Swaggerï¼š

   ä¾èµ–åŒ…

   ```xml
   <dependency>
     <groupId>io.springfox</groupId>
     <artifactId>springfox-swagger2</artifactId>
     <version>2.9.2</version>
   </dependency>
   <dependency>
     <groupId>io.springfox</groupId>
     <artifactId>springfox-swagger-ui</artifactId>
     <version>2.9.2</version>
   </dependency>
   ```

   é…ç½®ä»£ç 

   ```java
   @Configuration
   @EnableSwagger2
   public class SwaggerConfig {
       @Bean
       public Docket createRestApi() {
           return new Docket(DocumentationType.SWAGGER_2)
                   .pathMapping("/")
                   .select()
                   .apis(RequestHandlerSelectors.basePackage("com.example.controller"))
                   .build().apiInfo(new ApiInfoBuilder()
                           .title("ç è™«å®¢æ ˆ")
                           .description("ç è™«å®¢æ ˆ-åœ¨çº¿ä»£ç è¯„æµ‹ç³»ç»Ÿ")
                           .build());
       }
   }
   ```

   ### 12.19

   1. å®Œæˆåˆ¤é¢˜æœåŠ¡å™¨(app.js)ã€åˆ¤é¢˜æœåŠ¡å™¨é›†ç¾¤ç›‘æ§ä¸­å¿ƒ(ClusterMonitor.js)ç¼–å†™ã€‚

   2. æ‰©å®¹ä¸€å°åˆ¤é¢˜æœºï¼š

      >- åˆ›å»ºä¸€ä¸ªæ–°çš„Dockerå®¹å™¨ç”¨äºå­˜æ”¾åˆ¤é¢˜æœºã€‚
      >
      >  ```shell
      >  docker run -it -d \
      >  	--name=judge_4 \
      >  	-v /Users/huangzexu/Code/Subject:/Subject:ro \
      >  	ubuntu:latest
      >  ```
      >
      >- å®¹å™¨åˆå§‹åŒ–
      >
      >  ```shell
      >  // åœ¨å®¹å™¨å†…éƒ¨æ–°å»ºä¸€ä¸ªJudgeæ–‡ä»¶å¤¹ç”¨äºè£…è½½åˆ¤é¢˜æœºä»¥åŠç”¨æˆ·ä»£ç ã€‚
      >  docker exec judge_4 mkdir Judge
      >  // å¤åˆ¶æœ¬åœ°åˆ¤é¢˜æœºä»£ç è¿›å…¥è‡³å®¹å™¨å†…éƒ¨
      >  docker cp /Users/huangzexu/Code/C-C++/Docker/test/Run.cpp judge_4:/Judge
      >  docker cp /Users/huangzexu/Code/C-C++/Docker/test/Run.h judge_4:/Judge
      >  // å®‰è£…C++ç¼–è¯‘å™¨
      >  docker exec judge_4 apt-get update
      >  docker exec judge_4 apt-get install g++ -y
      >  // ç¼–è¯‘åˆ¤é¢˜æœºä»£ç 
      >  docker exec judge_4 g++ /Judge/Run.cpp -o /Judge/Run
      >  ```
      >
      >- ä¿®æ”¹åˆ¤é¢˜ç›‘æ§ä¸­å¿ƒé…ç½® /config/DockerConfig.js :
      >
      >  ```javascript
      >  exports.Judges = [
      >      { "Name": "judge_1" },
      >      { "Name": "judge_2" },
      >      { "Name": "judge_3" },
      >      { "Name": "judge_4" }		// åŠ å…¥å¤šä¸€æ¡æ–°çš„å®¹å™¨åç§°å³å¯
      >  ];
      >  ```
      >
      >- é‡æ–°è¿è¡Œåˆ¤é¢˜ç›‘æ§ä¸­å¿ƒå³å¯:
      >
      >  ```shell
      >  node ClusterMonitor.js
      >  ```

   

### 12.20

1. æ–°çš„ä¸šåŠ¡éœ€æ±‚ï¼š

   >åˆ¤é¢˜æœºçš„åŠŸèƒ½ä¸å±€é™äºå•å•è¿›è¡Œæ ·ä¾‹è¾“å…¥è¾“å‡ºçš„æ ¡å¯¹ï¼Œåº”è¯¥å…·å¤‡ç”¨æˆ·è‡ªå®šä¹‰è¾“å…¥ã€‚
   >
   >1. ç”¨æˆ·é¡µé¢ä¸Šè‡ªå®šä¹‰è¾“å…¥æ•°æ®ã€‚
   >2. å‰ç«¯æŠŠä»£ç ã€è‡ªå®šä¹‰è¾“å…¥ã€è¯­è¨€ç¯å¢ƒ...å‘é€è‡³JavaæœåŠ¡å™¨è¿›è¡Œæ‰“åŒ…æ‰”ç»™MQã€‚ï¼ˆå¤‡æ³¨æ˜¯ç”¨æˆ·è‡ªå®šä¹‰è¾“å…¥ï¼‰
   >3. NodeJsæœåŠ¡å™¨æ”¶åˆ°ä»»åŠ¡åï¼Œåˆ¤æ–­å¦‚æœä¸ºè‡ªå®šä¹‰è¾“å…¥ï¼Œåˆ™å°†è¾“å…¥æ–‡ä»¶åŒä»£ç ä¸€èµ·å†™å…¥è‡³Judgeç›®å½•ã€‚
   >4. éšåNodeJsæœåŠ¡å™¨æ‰§è¡Œå®¹å™¨å†…å‘½ä»¤ï¼Œå¯åŠ¨åˆ¤é¢˜æœºæ—¶é™„ä¸Šå‚æ•°è¡¨è®¡ä¸ºç”¨æˆ·è‡ªå®šä¹‰è¾“å…¥ã€‚
   >5. åˆ¤é¢˜æœºè‹¥æ”¶åˆ°è‡ªå®šä¹‰è¾“å…¥æ–‡ä»¶è·¯å¾„åˆ™ä¸éœ€è¦ä¸é¢˜åº“ä¸­çš„è¾“å…¥è¾“å‡ºæ–‡ä»¶è¿›è¡Œæ¯”å¯¹ã€‚

### 12.23

- [x] å®Œæˆæ³¨å†Œ
- [x] å®Œå–„ç™»é™†
- [x] æ•´ä¸ªé¡¹ç›®ä»£ç è§£è€¦
- [x] å®Œæˆç­”é¢˜é¡µé¢çš„æ•ˆæœ
- [x] æ‰‹åŠ¨çˆ¬å–é¢˜ç›®æ•°æ®è‡³æ•°æ®åº“ä¸æœ¬åœ°æ ·ä¾‹é¢˜åº“
- [ ] è®ºæ–‡æ’°å†™5000å­—

- [ ] ç ”ç©¶MQçš„å»¶è¿Ÿæ¶ˆæ¯é˜Ÿåˆ—é’ˆå¯¹äºæ³¨å†Œé‚®ç®±æ¿€æ´»æœ‰æ•ˆæ—¶é—´
- [x] ç¼–å†™DockerFileä¸€é”®åˆ¶ä½œDockeré•œåƒ
- [ ] ç ”ç©¶Pythonè¯­è¨€ç¯å¢ƒè¿è¡Œ



### 12.25

æ‹“å±•ä¸€ä¸ªåˆ¤é¢˜æœºçš„æ–¹æ³•ï¼š

åœ¨æœ¬åœ°ä¸­æ–°å»ºä¸€ä¸ªç›®å½•æ”¾å…¥ç¼–å†™å¥½çš„Dockerfileã€judge.cppã€judge.h

<img src="./img/image-20211225064911194.png" alt="image-20211225064911194" style="zoom:50%;" />

>Dockerfile è¯´æ˜
>
>æŠŠå®¿ä¸»å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰åˆ¤é¢˜æœºæºç æ–‡ä»¶å¤åˆ¶è‡³å®¹å™¨å†…éƒ¨
>
>éšåæ›´æ–°æºï¼Œå®‰è£…g++ç¼–è¯‘å™¨ã€ç¼–è¯‘åˆ¤é¢˜æœºã€å®‰è£…python2.7ã€pythonè½¯è¿æ¥

```dockerfile
FROM ubuntu:latest 
COPY judge* /Judge/
RUN apt-get update \ 
    && apt-get install g++ -y \
    && g++ /Judge/judge.cpp -o /Judge/judge \
    && apt-get install python2.7 -y\
    && ln -s /usr/bin/python2.7 /usr/bin/python
```

åœ¨æœ¬ç›®å½•ä¸­æ„å»ºé•œåƒï¼š

```dockerfile
docker build -t ubuntu:judge .
```

![image-20211225065259173](./img/image-20211225065259173.png)

å¯åŠ¨å®¹å™¨ï¼š

```shell
docker run -it -d --name=judge_* -v /Users/huangzexu/Code/Subject:/Subject:ro ubuntu:judge
```

>/Users/huangzexu/Code/Subjectï¼šæŒ‚è½½æœ¬åœ°çš„é¢˜ç›®åº“
>
>judge_*ï¼šä¸ºæ‚¨éœ€è¦æ›´æ”¹çš„åˆ¤é¢˜æœºåç§°

